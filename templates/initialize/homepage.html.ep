<!DOCTYPE HTML PUBLIC '-//W3C//DTD HTML 4.01//EN'
'http://www.w3.org/TR/html4/strict.dtd'>
<html>

<head>

	<title>Garden Design</title>
	<meta http-equiv = 'Content-Type' content = 'text/html; charset = utf-8' />

	<link rel='stylesheet' type='text/css' href='http://127.0.0.1/assets/js/jQuery/jquery-ui-1.12.1/jquery-ui.min.css'>
	<link rel='stylesheet' type='text/css' href='http://127.0.0.1/assets/js/jQuery/datatables.min.css'>
	<!-- Warning: The next line must not be put after the spectrum line, or the CSS in it fails to work. -->
	<link rel = 'stylesheet' type = 'text/css' href = 'http://127.0.0.1/assets/css/www/garden/design/homepage.css'>
	<link rel = 'stylesheet' type = 'text/css' href = 'http://127.0.0.1/assets/js/spectrum/spectrum.css'>

</head>

<body>

<h3 class = 'blue_centered'>Garden Design</h3>

<div id = 'global_tab_div'>
	<ul>
		<li><a href = '#global_search_tab'><span>Search</span></a></li>
		<li><a href = '#global_details_tab'><span>Details</span></a></li>
		<li><a href = '#global_garden_tab'><span>Gardens</span></a></li>
		<li><a href = '#global_object_tab'><span>Objects</span></a></li>
		<li><a href = '#global_design_tab'><span>Design</span></a></li>
		<li><a href = '#global_help_tab'><span>Help</span></a></li>
	</ul>
	<div id = 'global_search_tab'>
%= include 'initialize/search'
	</div>
	<div id = 'global_details_tab'>
%= form_for '/SaveFlowerDetails' => (method => 'POST') => begin
	    <ul>
	        <li><a href = '#flower_tab'><span>Flower</span></a></li>
	        <li><a href = '#attributes_tab'><span>Attributes</span></a></li>
	        <li><a href = '#images_tab'><span>Images</span></a></li>
	        <li><a href = '#notes_tab'><span>Notes</span></a></li>
	        <li><a href = '#urls_tab'><span>URLs</span></a></li>
	    </ul>
	    <div id = 'flower_tab'>
%= include 'initialize/flower'
		</div>
	    <div id = 'attributes_tab'>
%= include 'initialize/attributes'
		</div>
	    <div id = 'images_tab'>
%= include 'initialize/images', constants => $constants
		</div>
	    <div id = 'notes_tab'>
%= include 'initialize/notes', constants => $constants
		</div>
	    <div id = 'urls_tab'>
%= include 'initialize/urls'
		</div>
% end
	</div>
	<div id = 'global_garden_tab'>
%= include 'initialize/garden', garden_menu => $garden_menu, property_menu => $property_menu
	</div>
	<div id = 'global_object_tab'>
%= include 'initialize/object', object_menu => $object_menu
	</div>
	<div id = 'global_design_tab'>
%= include 'initialize/design', constants => $constants
	</div>
	<div id = 'global_help_tab'>
		<div id = 'help_div'>
		    <ul>
		        <li><a href = '#search_help_tab'><span>Searching</span></a></li>
		        <li><a href = '#faq_help_tab'><span>FAQ</span></a></li>
		    </ul>
		    <div id = 'search_help_tab'>
%= include 'initialize/search_help'
			</div>
		    <div id = 'faq_help_tab'>
%= include 'initialize/faq_help'
			</div>
		</div>
	</div>
</div>

</body>

%= javascript 'http://127.0.0.1/assets/js/jQuery/jquery-3.1.1.min.js'
%= javascript 'http://127.0.0.1/assets/js/jQuery/jquery-migrate-3.0.0.js'
%= javascript 'http://127.0.0.1/assets/js/jQuery/jquery-ui-1.12.1/jquery-ui.min.js'
%= javascript 'http://127.0.0.1/assets/js/jQuery/datatables.min.js'
%= javascript 'http://127.0.0.1/assets/js/spectrum/spectrum.js'

<script type = 'text/javascript'>

// Storage for info read in below from the database.

var attribute_types_table	= [];
var design_flower_index		= 0;
var design_object_index		= 0;
var garden_table			= [];
var object_table			= [];

// -----------------------------------------------

$(function()
{
	$('#aliases')
	.autocomplete
	({
		source:		'/AutoComplete?type=aliases',
		minLength:	2,
		select:		function(event, ui)
		{
			$('#aliases').empty().append(ui.item ? ui.item.value : '-');
		}
	});

}); // End of autocomplete function.

// -----------------------------------------------

$(function()
{
	$('#common_name')
	.autocomplete
	({
		source:		'/AutoComplete?type=common_name',
		minLength:	2,
		select:		function(event, ui)
		{
			$('#common_name').empty().append(ui.item ? ui.item.value : '-');
		}
	});

}); // End of autocomplete function.

// -----------------------------------------------

$(function()
{
	$('#garden_name')
	.autocomplete
	({
		source:		'/AutoComplete?type=garden_name',
		minLength:	2,
		select:		function(event, ui)
		{
			if (ui.item)
			{
				$('#garden_name').empty().append(ui.item.value);
			}
		}
	});

}); // End of autocomplete function.

// -----------------------------------------------

$(function()
{
	$('#object_name')
	.autocomplete
	({
		source:		'/AutoComplete?type=object_name',
		minLength:	2,
		select:		function(event, ui)
		{
			$('#object_name').empty().append(ui.item ? ui.item.value : '-');
		}
	});

}); // End of autocomplete function.

// -----------------------------------------------

$(function()
{
	$('#property_name')
	.autocomplete
	({
		source:		'/AutoComplete?type=property_name',
		minLength:	2,
		select:		function(event, ui)
		{
			if (ui.item)
			{
				$('#property_name').empty().append(ui.item.value);
			}
		}
	});

}); // End of autocomplete function.

// -----------------------------------------------

$(function()
{
	$('#scientific_name')
	.autocomplete
	({
		source:		'/AutoComplete?type=scientific_name',
		minLength:	2,
		select:		function(event, ui)
		{
			$('#scientific_name').empty().append(ui.item ? ui.item.value : '-');
		}
	});

}); // End of autocomplete function.

// -----------------------------------------------

$(function()
{
	$("#search_text")
	.autocomplete
	({
		source: "/AutoComplete?type=search",
		minLength: 2,
		select: function(event, ui)
		{
			$("#search_text")
			.empty()
			.append(ui.item ? ui.item.value : "-");
		}
	});
});

// -----------------------------------------------

function build_attribute_id(kind, name, value)
{
	// We must allow for range values like 'Full sun' and 'Semi-dwarf'.

	value = value.replace(/\s|-/g, '_');

	return '#' + kind + '_' + name + '_' + value;

} // End of build_attribute_id.

// -----------------------------------------------

function build_garden_menu(property_id)
{
	var first_id	= 0;
	var html		= "<label for 'garden_menu'>Garden: </label><br />"
						+ "<select name = 'garden_menu' id = 'garden_menu'>";

	var id;
	var name;

	for (var i = 0; i < garden_table.length; i++)
	{
		if (garden_table[i]['property_id'] == property_id)
		{
			id		= garden_table[i]['id'];
			name	= garden_table[i]['name'];
			html	+= "<option value = '" + id + "'>" + name + '</option>';

			if (first_id == 0)
			{
				first_id = id;
			}
		}
	}

	html += '</select>';

	$('#garden_menu_placeholder')
	.empty()
	.append(html);

	$('#garden_menu')
	.selectmenu
	({
		change: function(event, data)
		{
			garden_menu_changed(data);
		}
	});

} // End of build_garden_menu.

// -----------------------------------------------

function build_image_ids(sequence)
{
	// Names are in alphabetical order.

	var ids =
	[
		'#image_description_' + sequence,	// 0.
		'#image_file_name_' + sequence,		// 1.
		'#image_image_' + sequence,			// 2.
		'#image_sequence_' + sequence		// 3.
	];

	return ids;

} // End of build_image_ids.

// -----------------------------------------------

function build_note_ids(sequence)
{
	// Names are in alphabetical order.

	var ids	=
	[
		'#note_note_' + sequence,		// 0.
		'#note_sequence_' + sequence	// 1.
	];

	return ids;

} // End of build_note_ids.

// -----------------------------------------------

function build_property_menu()
{
	var first_id	= 0;
	var html		= "<label for 'property_menu'>Property: </label><br />"
						+ "<select name = 'property_menu' id = 'property_menu'>";

	var id;
	var name;

	for (var i = 0; i < property_table.length; i++)
	{
		id		= property_table[i]['id'];
		name	= property_table[i]['name'];
		html	+= "<option value = '" + id + "'>" + name + '</option>';

		if (first_id == 0)
		{
			first_id = id;
		}
	}

	html += '</select>';

	$('#property_menu_placeholder')
	.empty()
	.append(html);

	$('#property_name')
	.focus();

	$('#property_menu')
	.selectmenu
	({
		change: function(event, data)
		{
			property_menu_changed(data);
		}
	});

} // End of build_property_menu.

// -----------------------------------------------

function build_url_ids(sequence)
{
	// Names are in alphabetical order.

	var ids	=
	[
		'#url_sequence_' + sequence,	// 0.
		'#url_url_' + sequence			// 1.
	];

	return ids;

} // End of build_url_ids.

// -----------------------------------------------
// Note: Changed means the user changed the selected item.

function garden_menu_changed(data)
{
//	for( key in data )
//	{
//		alert( "key is " + [ key ] + ", value is " + data[ key ] );
//	}

// Typical keys for data.item are:
//	o label => The garden item's text (name column).
//	o value => The garden item's # (primary key column).

	current_garden_id = data.item.value;

	for (var i = 0; i < garden_table.length; i++)
	{
		if (garden_table[i]['id'] == current_garden_id)
		{
			set_garden_fields(i);

			break;
		}
	}

} // End of garden_menu_changed.

// -----------------------------------------------

function get_attribute_types()
{
	$.get
	(
		'/GetTable/attribute_types',
		null,
		function(json)
		{
			attribute_types_table = json;
		},
		'json'
	);

} // End of get_attribute_types.

// -----------------------------------------------
// Warning: This function cannot be used to populate object_menu_placeholder
// since that involves changing the DOM, but the function is called from within
// the document ready context which assumes the DOM has stopped changing.

function get_object_table()
{
	$.get
	(
		'/GetTable/objects',
		null,
		function(json)
		{
			object_table = json;

			set_object_fields(0);

			get_garden_table();
		},
		'json'
	);

} // End of get_object_table.

// -----------------------------------------------
// Warning: This function cannot be used to populate garden_menu_placeholder
// since that involves changing the DOM, but the function is called from within
// the document ready context which assumes the DOM has stopped changing.

function get_garden_table()
{
	$.get
	(
		'/GetTable/gardens',
		null,
		function(json)
		{
			garden_table = json;

			set_property_fields(0);
			set_garden_fields(0);
		},
		'json'
	);

} // End of get_garden_table.

// -----------------------------------------------

function populate_details(flower_id)
{
	$.ajax
	({
		data:
		{
			flower_id: flower_id
		},
		dataType:	'json',
		method:		'POST',
		url:		'/GetFlowerDetails'
	})
	.done(function(flower)
	{
		// Make the Details tab, tab 1, active.

		$('#global_tab_div')
		.tabs('option', 'active', 1);

		// Copy flower data to the Details/Flower tab.

		$('#flower_common_name')
		.val(flower['common_name']);

		$('#flower_scientific_name')
		.val(flower['scientific_name']);

		$('#flower_aliases')
		.val(flower['aliases']);

		$('#flower_height')
		.val(flower['height']);

		$('#flower_width')
		.val(flower['width']);

		var thumbnail_size		= <%== $$constants{search_thumbnail_size} %>;
		var thumbnail_string	= "width = '" + thumbnail_size + "' height = '" + thumbnail_size + "'";
		var homepage_url		= <%== $$constants{homepage_url4js} %>;
		var image_url			= <%== $$constants{image_url4js} %>;
		var image_path			= homepage_url + image_url + '/' + flower['pig_latin'] + '.0.jpg';
		var thumbnail_html		= "<img src = '" + image_path + "' " + thumbnail_string + '>';

		$('#flower_thumbnail')
		.html(thumbnail_html);

		// Copy basic flower data to the Details/Flower's other sub-tabs.
		// Warning: Don't include 'details' in the tabs array, because
		// it's fields are input fields, while all others are spans.

		var tabs = ['attribute', 'note', 'image', 'url'];
		var vars = ['common_name', 'scientific_name'];

		var id;

		for (var i = 0; i < tabs.length; i++)
		{
			for (var j = 0; j < vars.length; j++)
			{
				id = '#' + tabs[i] + '_' + vars[j];

				$(id)
				.text(flower[vars[j] ]);
			}
		}

		// Populate 3 flower fields on the Design tab.

		design_flower_index++;

		if (design_flower_index > 4)
		{
			design_flower_index = 1;
		}

		var drag_id		= '#design_flower_drag_' + design_flower_index;
		var drag_div	= "<div id = '" + drag_id + "' class = 'ui-widget-content'>";
		var icon_id		= '#design_flower_' + design_flower_index;

		$(icon_id)
		.html(drag_div + thumbnail_html + '</div>');

		$(drag_id).draggable();

		$('#design_droppable_1').droppable(
		{
			drop: function()
			{
				alert('Dropped');
			}
		});

		for (var i = 0; i < vars.length; i++)
		{
			id = '#design_' + vars[i] + '_' + design_flower_index;

			$(id)
			.text(flower[vars[i] ]);
		}

		// Copy attributes to the Details/Attributes tab.

		var attribute_name;
		var range = new Array();
		var value;

		// Attributes: Copy attribute types to the Flower/Attributes tab.
		// 1: Remove any existing attributes.

		for (var i = 0; i < attribute_types_table.length; i++)
		{
			attribute_name	= attribute_types_table[i]['name'];
			range			= attribute_types_table[i]['range'].split(', ');

			for (var j = 0; j < range.length; j++)
			{
				value	= range[j];
				id		= build_attribute_id('attribute', attribute_name, value);

				$(id)
				.prop('checked', false);
			}
		}

		var attribute;
		var attribute_type_name;

		// 2: Loop over all attributes owned by this flower.

		for (var i = 0; i < flower['attributes'].length; i++)
		{
			attribute		= flower['attributes'][i];
			attribute_name	= attribute['name'];
			range			= attribute['range'].split(', ');

			// Loop over all attribute types.

			for (var j = 0; j < attribute_types_table.length; j++)
			{
				attribute_type_name = attribute_types_table[j]['name'];

				// Find the attribute type whose name matches the name of the flower's attribute.

				if (attribute_name != attribute_type_name)
				{
					continue;
				}

				for (var k = 0; k < range.length; k++)
				{
					value	= range[k];
					id		= build_attribute_id('attribute', attribute_name, value);

					if (value != '')
					{
						$(id)
						.prop('checked', true);
					}
				}
			}
		}

		// Images: Copy images to the Details/Images tab.
		// 1: Remove any existing images.

		var ids			= [];
		var image_count	= <%== $$constants{max_image_count} %>;

		for (var i = 0; i < image_count; i++)
		{
			ids.push(build_image_ids(i + 1) );

			// For the HTML column order, see templates/initialize/images.html.ep.

			$(ids[i][0])
			.val('');	// Description.

			$(ids[i][1])
			.val('');	// File name.

			$(ids[i][2])
			.text('');	// Image.

			$(ids[i][3])
			.val('');	// Sequence.
		}

		// 2: Loop over all images owned by this flower.

		ids			= [];
		image_count	= (flower['images'].length > image_count) ? image_count : flower['images'].length;

		var description;
		var file_name;
		var sequence;

		for (var i = 0; i < image_count; i++)
		{
			description		= flower['images'][i]['description'];
			file_name		= flower['images'][i]['file_name'];
			sequence		= flower['images'][i]['sequence'];
			ids[i]			= build_image_ids(sequence);
			image_path		= homepage_url + image_url + '/' + file_name;
			thumbnail_html	= "<img src = '" + image_path + "' " + thumbnail_string + '>';

			// For the HTML column order, see templates/initialize/images.html.ep.

			$(ids[i][0])
			.val(description);

			$(ids[i][1])
			.val(file_name);

			$(ids[i][2])
			.html(thumbnail_html);

			$(ids[i][3])
			.val(sequence);
		}

		// Notes: Copy notes to the Details/Notes tab.
		// 1: Remove any existing notes.

		ids			= [];
		note_count	= <%== $$constants{max_note_count} %>;

		for (var i = 0; i < note_count; i++)
		{
			ids.push(build_note_ids(i + 1) );

			// For the HTML column order, see templates/initialize/notes.html.ep.

			$(ids[i][0])
			.val('');	// Note.

			$(ids[i][1])
			.val('');	// Sequence.
		}

		// 2: Loop over all notes owned by this flower.

		ids			= [];
		note_count	= (flower['notes'].length > note_count) ? note_count : flower['notes'].length;

		var note;

		for (var i = 0; i < note_count; i++)
		{
			note		= flower['notes'][i]['note'];
			sequence	= flower['notes'][i]['sequence'];
			ids[i]		= build_note_ids(sequence);

			// For the HTML column order, see templates/initialize/notes.html.ep.

			$(ids[i][0])
			.val(note);

			$(ids[i][1])
			.val(sequence);
		}

		// URLs: Copy urls to the Details/URLs tab.
		// 1: Remove any existing URLs.

		ids			= [];
		url_count	= <%== $$constants{max_url_count} %>;

		for (var i = 0; i < url_count; i++)
		{
			ids.push(build_url_ids(i) );

			// For the HTML column order, see templates/initialize/urls.html.ep.

			$(ids[i][0])
			.val('');	// Sequence.

			$(ids[i][1])
			.val('');	// URL.
		}

		// 2: Loop over all URLs owned by this flower.

		ids			= [];
		url_count	= (flower['urls'].length > url_count) ? url_count : flower['urls'].length;

		var url;

		for (var i = 0; i < url_count; i++)
		{
			sequence	= flower['urls'][i]['sequence'];
			url			= flower['urls'][i]['url'];
			ids[i]		= build_url_ids(sequence);

			// For the HTML column order, see templates/initialize/urls.html.ep.

			$(ids[i][0])
			.val(sequence);

			$(ids[i][1])
			.val(url);
		}
	})
	.fail(function(jqxhr, textStatus, error)
	{
		alert('Ajax status: ' + textStatus + ', ' + error);
	});

} // End of populate_details.

// -----------------------------------------------
// Note: Changed means the user changed the selected item.

function object_menu_changed(data)
{
	//	for( key in data )
	//	{
	//		alert( "key is " + [ key ] + ", value is " + data[ key ] );
	//	}

	// Typical keys for data.item are:
	//	o label => The object item's text (name column).
	//	o value => The object item's # (primary key column).

	current_object_id = data.item.value;

	for (var i = 0; i < object_table.length; i++)
	{
		if (object_table[i]['id'] == current_object_id)
		{
			set_object_fields(i);

			break;
		}
	}

} // End of object_menu_changed.

// -----------------------------------------------

function populate_design_tab_placeholders()
{
	var homepage_url		= <%== $$constants{homepage_url4js} %>;
	var icon_url			= <%== $$constants{icon_url4js} %>;
	var icon_path			= homepage_url + icon_url + '/white.tile.png';
	var thumbnail_size		= <%== $$constants{design_thumbnail_size} %>;
	var thumbnail_string	= "width = '" + thumbnail_size + "' height = '" + thumbnail_size + "'";
	var icon_html			= "<img src = '" + icon_path + "' " + thumbnail_string + '>';

	// Copy the white tile into each of 4 dummy flowers and 4 dummy objects.
	// I chose 4 because the result fits neatly on the screen of my laptop.

	for (var i = 1; i <= 4; i++)
	{
		id = '#design_flower_' + i;

		$(id)
		.html(icon_html);

		id = '#design_object_' + i;

		$(id)
		.html(icon_html);
	}

} // End of populate_design_tab_placeholders.

// -----------------------------------------------
// Note: Changed means the user changed the selected item.

function property_menu_changed(data)
{
	//	for( key in data )
	//	{
	//		alert( "key is " + [ key ] + ", value is " + data[ key ] );
	//	}

	// Typical keys for data.item are:
	//	o label => The property item's text (name column).
	//	o value => The property item's # (primary key column).

	current_property_id = data.item.value;

	for (var i = 0; i < garden_table.length; i++)
	{
		if (garden_table[i]['property_id'] == current_property_id)
		{
			set_property_fields(i);
			build_garden_menu(current_property_id);
			set_garden_fields(i);

			break;
		}
	}

} // End of property_menu_changed.

// -----------------------------------------------

function set_garden_fields(i)
{
	$('#garden_description')
	.val(garden_table[i]['description']);

	$('#garden_name')
	.val(garden_table[i]['name']);

} // End of set_garden_fields.

// -----------------------------------------------

function set_object_fields(i)
{
	$('#color_code')
	.val(object_table[i]['hex_color']);

	$('#object_name')
	.val(object_table[i]['name'])
	.focus();

	$('#object_icon')
	.attr('src', object_table[i]['icon_url']);

	$('#color_spectrum')
	.spectrum('set', object_table[i]['hex_color']);

	$('#color_swatch_chosen')
	.css('background-color', object_table[i]['hex_color']);

	// Put color in hidden form field for submit.

	$('#real_color')
	.val(object_table[i]['hex_color']);

	// Popuate 3 fields on the Design tab.

	design_object_index++;

	if (design_object_index > 4)
	{
		design_object_index = 1;
	}

	var id					= '#design_object_' + design_object_index;
	var thumbnail_size		= <%== $$constants{design_thumbnail_size} %>;
	var thumbnail_string	= "width = '" + thumbnail_size + "' height = '" + thumbnail_size + "'";

	$(id)
	.html("<img src = '" + object_table[i]['icon_url'] + "' " + thumbnail_string + '>');

	id = '#design_object_name_' + design_object_index;

	$(id)
	.text(object_table[i]['name']);

} // End of set_object_fields.

// -----------------------------------------------

function set_property_fields(i)
{
	$('#property_description')
	.val(garden_table[i]['property_description']);

	$('#property_name')
	.val(garden_table[i]['property_name']);

} // End of set_property_fields.

// -----------------------------------------------

function submit_flower()
{
	$.ajax
	({
		data:
		{
			aliases:			document.aliases.value,
			common_name:		document.common_name.value,
			edible:				document.attributes_form.edible.value,
			habit:				document.attributes_form.habit.value,
			native:				document.attributes_form.native,
			scientific_name:	document.scientific_name.value,
			sun_tolerance:		document.attributes_form.sun_tolerance.value
		},
		dataType:	'text',
		method:		'POST',
		url:		'/AddFlower'
	})
	.done(function(html)
	{
		// $('#flower_result_div')
		//	.empty()
		//	.append(html);

			$('#flower_result_div')
			.empty()
			.text('Hi!');
	})
	.fail(function(jqxhr, textStatus, error)
	{
		alert('Ajax status: ' + textStatus + ', ' + error);
	});

} // End of submit_flower.

// -----------------------------------------------

function submit_garden()
{
	$.ajax
	({
		data:
		{
			garden_description:		$('#garden_description').val(),
			garden_name:			$('#garden_name').val(),
			property_description:	$('#property_description').val(),
			property_name:			$('#property_name').val()
		},
		dataType:	'html',
		method:		'POST',
		url:		'/AddGarden'
	})
	.done(function(html)
	{
		$('#garden_result_div')
		.empty()
		.append(html);

		get_property_gardens();
	})
	.fail(function(jqxhr, textStatus, error)
	{
		alert('Ajax status: ' + textStatus + ', ' + error);
	});

} // End of submit_garden.

// -----------------------------------------------

function submit_search()
{
	var fields = new Object();

	fields['csrf_token']	= $('#csrf_token').val();
	fields['search_text']	= $('#search_text').val();

	// Copy attributes from the search form.

	var attribute_name;
	var id;
	var name;
	var range = new Array();
	var value;

	for (var i = 0; i < attribute_types_table.length; i++)
	{
		attribute_name	= attribute_types_table[i]['name'];
		range			= attribute_types_table[i]['range'].split(', ');

		for (var j = 0; j < range.length; j++)
		{
			value			= range[j];
			id				= build_attribute_id('search', attribute_name, value);
			name			= id.substr(1); // Discard leading '#' to get the name to submit.
			fields[name]	= $(id).prop('checked'); // Returns 'true' or 'false'.
		}
	}

	$.ajax
	({
		data:		fields,
		dataType:	'html',
		type:		'POST',
		url:		'/Search'
	})
	.done(function(html)
	{
		$('#search_result_div')
		.empty()
		.append(html);

		$('#search_text')
		.focus();
	})
	.fail(function(jqxhr, textStatus, error)
	{
		alert('Ajax status: ' + textStatus + ', ' + error);
	});

} // End of submit_search.

// -----------------------------------------------

$(function()
{
	get_attribute_types();
	get_object_table();
	populate_design_tab_placeholders();

	// Enable the tabs before trying to work with them.

	$('global_tab_div')
	.tabs
	({
		active: 1
	});

	// If the property tab is selected, give the focus to the property name.

	$('#property_menu')
	.selectmenu
	({
		change: function(event, data)
		{
			property_menu_changed(data);
		}
	});

	$('#object_menu')
	.selectmenu
	({
		change: function(event, data)
		{
			object_menu_changed(data);
		}
	});

	$('#garden_menu')
	.selectmenu
	({
		change: function(event, data)
		{
			garden_menu_changed(data);
		}
	});

	// If the Search tab is selected, give the focus to the search text.

	$('#global_tab_div')
	.tabs
	({
		activate: function(event, ui)
		{
			$('#search_text')
			.focus();
		}
	});

	// If the Objects tab is selected, give the focus to the object name.

	$('#global_object_tab')
	.tabs
	({
		activate: function(event, ui)
		{
			$('#object_name')
			.focus();
		}
	});

	// Active sub-tabs for Detail and Help.

	$("#global_details_tab")
	.tabs
	({
		active: 0
	});

	$("#global_help_tab")
	.tabs
	({
		active: 0
	});

	$('#color_spectrum')
	.spectrum
	({
		change:				function(color)
							{
								$('#color_swatch_chosen')
								.css('background-color', color.toHexString() );
								$('#real_color')
								.val(color.toHexString() ); // Put color in hidden form field for submit.
							},
		color:				'white',
		preferredFormat:	'hex',
		showInput:			true,
		showPalette:		true
	});

	$('#flower_form')
	.submit(function()
	{
		submit_flower();

		return false;
	});

	$('#garden_form')
	.submit(function()
	{
		submit_garden();

		return false;
	});

	$('#search_form')
	.submit(function()
	{
		submit_search();

		return false;
	});

	$('#search_text')
	.focus();
});

</script>

</html>
